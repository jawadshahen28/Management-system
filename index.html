<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <!-- الحل السحري للجوالات -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, shrink-to-fit=no, viewport-fit=cover">
    <title>مدير الدار - النظام المالي الذكي</title>
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/ar.js"></script>
    
    <style>
        /* ===== إعادة تعيين كامل للجوال ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --gold: #c7a23b;
            --gold-dark: #a07e2b;
            --gold-light: #e2c27d;
            --navy: #0a1929;
            --navy-light: #1e3a5f;
            --green: #0b8f6c;
            --red: #b33a4a;
            --gray: #94a3b8;
            --glass: rgba(10, 25, 41, 0.85);
            --radius: 24px;
            --radius-sm: 18px;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--navy);
            color: white;
            line-height: 1.5;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* خلفية ذهبية ناعمة */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 80% 10%, rgba(199, 162, 59, 0.05) 0%, transparent 60%),
                        radial-gradient(circle at 20% 90%, rgba(11, 143, 108, 0.05) 0%, transparent 60%);
            z-index: -1;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* ===== الهيدر - بحجم مناسب للجوال ===== */
        .header {
            background: var(--glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(199, 162, 59, 0.25);
            border-radius: 32px;
            padding: 16px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .crown-icon {
            width: 52px;
            height: 52px;
            background: rgba(199, 162, 59, 0.1);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--gold);
        }

        .crown-icon i {
            font-size: 28px;
            color: var(--gold);
        }

        .title h1 {
            font-size: 24px;
            font-weight: 900;
            color: white;
            line-height: 1.2;
        }

        .title span {
            font-size: 11px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .datetime {
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid rgba(199, 162, 59, 0.25);
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--gray);
        }

        /* ===== بطاقات الإحصائيات - 2×3 للجوال ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(199, 162, 59, 0.2);
            border-bottom: 3px solid var(--gold);
            border-radius: 22px;
            padding: 16px 12px;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .stat-title {
            font-size: 11px;
            font-weight: 700;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            background: rgba(199, 162, 59, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            font-size: 18px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: white;
            line-height: 1;
            word-break: break-word;
        }

        /* ===== البطاقات الرئيسية ===== */
        .card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(199, 162, 59, 0.2);
            border-radius: 28px;
            padding: 20px 16px;
            width: 100%;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(199, 162, 59, 0.2);
            padding-bottom: 16px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card-header h2 {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header h2 i {
            color: var(--gold);
            background: rgba(199, 162, 59, 0.1);
            padding: 8px;
            border-radius: 14px;
            font-size: 18px;
        }

        .badge {
            background: rgba(199, 162, 59, 0.15);
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 13px;
            color: var(--gold-light);
            border: 1px solid rgba(199, 162, 59, 0.3);
        }

        /* ===== النماذج - عمودية للجوال ===== */
        .form {
            background: rgba(0,0,0,0.2);
            border-radius: 22px;
            padding: 18px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .form-group {
            width: 100%;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(0,0,0,0.4);
            border: 1.5px solid rgba(199, 162, 59, 0.25);
            border-radius: 18px;
            font-size: 15px;
            color: white;
            font-family: 'Cairo', sans-serif;
        }

        .form-group input:focus {
            border-color: var(--gold);
            outline: none;
            background: rgba(0,0,0,0.6);
        }

        .form-group input::placeholder {
            color: #5a6b7c;
        }

        .btn {
            padding: 14px 20px;
            border-radius: 18px;
            font-weight: 700;
            font-size: 15px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            color: var(--navy);
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            font-family: 'Cairo', sans-serif;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
            background: rgba(0,0,0,0.2);
        }

        /* ===== الجداول مع تمرير أفقي سلس ===== */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 18px;
            margin-top: 8px;
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 550px; /* يسمح بالتمرير على الجوال */
        }

        th {
            text-align: right;
            padding: 14px 12px;
            color: var(--gold);
            font-size: 13px;
            font-weight: 700;
            border-bottom: 1px solid rgba(199, 162, 59, 0.25);
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: white;
            font-size: 14px;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(179, 58, 74, 0.2);
            color: #ffb3b3;
            border: 1px solid rgba(179, 58, 74, 0.3);
        }

        .status.paid {
            background: rgba(11, 143, 108, 0.2);
            color: #b0e5c0;
            border: 1px solid rgba(11, 143, 108, 0.3);
        }

        .action-btn {
            background: rgba(199, 162, 59, 0.1);
            border: 1px solid rgba(199, 162, 59, 0.3);
            padding: 8px 14px;
            border-radius: 14px;
            color: var(--gold);
            cursor: pointer;
            font-size: 14px;
        }

        .delete-btn {
            background: transparent;
            border: none;
            color: #888;
            padding: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        /* ===== سجل المعاملات ===== */
        .transactions-list {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .tx-icon {
            width: 44px;
            height: 44px;
            background: rgba(199, 162, 59, 0.1);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            font-size: 20px;
            flex-shrink: 0;
        }

        /* ===== تنبيه ===== */
        .alert {
            background: rgba(179, 58, 74, 0.2);
            border: 1px solid var(--red);
            border-radius: 22px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 8px;
        }

        /* ===== التوقيع - متجاوب ===== */
        .signature {
            margin-top: 20px;
            padding: 24px 20px;
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            border: 1px solid rgba(199, 162, 59, 0.2);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .signature {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .dev, .manager {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .dev-icon, .manager-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            flex-shrink: 0;
        }

        .dev-icon {
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            color: var(--navy);
        }

        .manager-icon {
            background: rgba(199, 162, 59, 0.1);
            border: 2px dashed var(--gold);
            color: var(--gold);
        }

        .dev-info h3 {
            font-size: 22px;
            font-weight: 900;
            color: white;
        }

        .dev-info h3 span, .manager-info h4 span {
            color: var(--gold);
        }

        .manager-info h4 {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .dev-info p, .manager-info p {
            color: var(--gray);
            font-size: 12px;
        }

        /* تحسينات للشاشات الصغيرة جداً */
        @media (max-width: 360px) {
            .container { padding: 12px 10px; }
            .title h1 { font-size: 20px; }
            .crown-icon { width: 44px; height: 44px; }
            .crown-icon i { font-size: 22px; }
            .stat-value { font-size: 20px; }
            .card-header h2 { font-size: 18px; }
        }

        /* إخفاء شريط التمرير الأنيق */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- الهيدر -->
        <div class="header">
            <div class="brand">
                <div class="crown-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="title">
                    <h1>مدير الدار</h1>
                    <span><i class="fas fa-shield-alt"></i> النظام التنفيذي v2.0</span>
                </div>
            </div>
            <div class="datetime">
                <div><i class="fas fa-calendar-alt" style="color: var(--gold);"></i> <span id="currentDate">...</span></div>
                <div><i class="fas fa-clock" style="color: var(--gold);"></i> <span id="currentTime">...</span></div>
            </div>
        </div>

        <!-- بطاقات الإحصائيات -->
        <div class="stats-grid" id="statsGrid"></div>

        <!-- تنبيه المصاريف -->
        <div id="expenseAlert" style="display: none;">
            <div class="alert">
                <div style="background: rgba(179,58,74,0.3); padding: 10px; border-radius: 14px;">
                    <i class="fas fa-exclamation-triangle" style="color: #ff8a8a; font-size: 22px;"></i>
                </div>
                <div>
                    <h4 style="color: white; font-weight: 800; margin-bottom: 2px;">تنبيه الميزانية</h4>
                    <p style="color: var(--gray); font-size: 13px;">المصاريف تتجاوز المبلغ المحصل!</p>
                </div>
            </div>
        </div>

        <!-- إدارة الأعضاء -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-users"></i> إدارة الأعضاء</h2>
                <span class="badge" id="memberStats">0/0</span>
            </div>
            <div class="form">
                <div class="form-group">
                    <label><i class="fas fa-user-tie"></i> اسم العضو الجديد</label>
                    <input type="text" id="memberNameInput" placeholder="أدخل الاسم الكامل">
                </div>
                <button class="btn" id="addMemberBtn">
                    <i class="fas fa-plus-circle"></i> إضافة عضو
                </button>
            </div>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>العضو</th>
                            <th>حالة الدفع</th>
                            <th>تاريخ الدفع</th>
                            <th>العمليات</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- إدارة المصاريف -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> إدارة المصاريف</h2>
                <span class="badge" id="expenseTotalBadge">0 ₪</span>
            </div>
            <div class="form">
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> اسم المصروف</label>
                    <input type="text" id="expenseNameInput" placeholder="مثال: فاتورة الكهرباء">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-coins"></i> المبلغ (₪)</label>
                    <input type="number" id="expenseAmountInput" placeholder="0.00">
                </div>
                <button class="btn" id="addExpenseBtn">
                    <i class="fas fa-plus-circle"></i> إضافة مصروف
                </button>
            </div>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>البيان</th>
                            <th>المبلغ</th>
                            <th>التاريخ</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="expensesTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- سجل المعاملات -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-history"></i> سجل المعاملات</h2>
                <button class="btn btn-outline" id="clearLogsBtn" style="width: auto; padding: 10px 18px;">
                    <i class="fas fa-trash-alt"></i> مسح
                </button>
            </div>
            <div id="transactionsList" class="transactions-list"></div>
        </div>

        <!-- بدء شهر جديد -->
        <button class="btn btn-outline" id="newMonthBtn" style="margin-bottom: 8px;">
            <i class="fas fa-calendar-plus"></i> بدء شهر جديد - إعادة تعيين حالات الدفع
        </button>

        <!-- توقيع المبرمج ومدير القاعدة -->
        <div class="signature">
            <div class="dev">
                <div class="dev-icon"><i class="fas fa-code"></i></div>
                <div class="dev-info">
                    <h3>جـ<span>و</span>اد شـ<span>اه</span>ين</h3>
                    <p><i class="fas fa-crown" style="color: var(--gold);"></i> مطور الأنظمة المالية المتقدمة</p>
                    <p style="font-size: 11px;"><i class="fas fa-certificate"></i> جواد شاهين © 2026</p>
                </div>
            </div>
            <div class="manager">
                <div class="manager-icon"><i class="fas fa-user-tie"></i></div>
                <div class="manager-info">
                    <h4><span>نعمان</span> | مدير القاعدة</h4>
                    <p><i class="fas fa-check-circle" style="color: var(--green);"></i> الإدارة التنفيذية والإشراف المالي</p>
                    <p style="font-size: 11px;"><i class="fas fa-map-marker-alt"></i> قاعدة الدار - النظام المركزي</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // تفعيل العربية
        moment.locale('ar');

        // ============ مدير الدار - نظام متكامل للجوال ============
        const DarExecutiveManager = {
            MEMBER_FEE: 30,
            
            keys: {
                MEMBERS: 'dar_members_final',
                EXPENSES: 'dar_expenses_final',
                TRANSACTIONS: 'dar_transactions_final'
            },

            members: [],
            expenses: [],
            transactions: [],

            // التهيئة
            init: function() {
                this.loadData();
                this.renderAll();
                this.attachEvents();
                setInterval(() => this.updateDateTime(), 1000);
                
                // جعل الدالة متاحة عالمياً
                window.app = this;
            },

            // تحميل البيانات
            loadData: function() {
                // الأعضاء
                let storedMembers = localStorage.getItem(this.keys.MEMBERS);
                if (storedMembers) {
                    this.members = JSON.parse(storedMembers);
                } else {
                    this.members = [
                        { id: '1', name: 'أحمد الموسى', paid: true, lastPaymentDate: '2026-02-10T10:30:00' },
                        { id: '2', name: 'سارة خالد', paid: false, lastPaymentDate: null },
                        { id: '3', name: 'محمد عمر', paid: true, lastPaymentDate: '2026-02-09T14:20:00' },
                        { id: '4', name: 'نور الهدى', paid: false, lastPaymentDate: null },
                        { id: '5', name: 'ياسر القحطاني', paid: true, lastPaymentDate: '2026-02-08T09:15:00' },
                        { id: '6', name: 'لمى سامي', paid: false, lastPaymentDate: null },
                        { id: '7', name: 'عبدالله فهد', paid: true, lastPaymentDate: '2026-02-07T16:45:00' },
                        { id: '8', name: 'هيا بدر', paid: false, lastPaymentDate: null },
                        { id: '9', name: 'فهد العلي', paid: true, lastPaymentDate: '2026-02-06T11:00:00' },
                        { id: '10', name: 'رنا إبراهيم', paid: false, lastPaymentDate: null }
                    ];
                }

                // المصاريف
                let storedExpenses = localStorage.getItem(this.keys.EXPENSES);
                if (storedExpenses) {
                    this.expenses = JSON.parse(storedExpenses);
                } else {
                    this.expenses = [
                        { id: 'e1', name: 'فاتورة الإنترنت', amount: 120, date: '2026-02-01T09:00:00' },
                        { id: 'e2', name: 'الكهرباء', amount: 95, date: '2026-02-05T13:30:00' },
                        { id: 'e3', name: 'المياه', amount: 45, date: '2026-02-10T11:20:00' },
                        { id: 'e4', name: 'صيانة عامة', amount: 40, date: '2026-02-12T15:40:00' }
                    ];
                }

                // المعاملات
                let storedTransactions = localStorage.getItem(this.keys.TRANSACTIONS);
                this.transactions = storedTransactions ? JSON.parse(storedTransactions) : [];
            },

            // حفظ البيانات
            saveMembers: function() {
                localStorage.setItem(this.keys.MEMBERS, JSON.stringify(this.members));
            },
            
            saveExpenses: function() {
                localStorage.setItem(this.keys.EXPENSES, JSON.stringify(this.expenses));
            },
            
            saveTransactions: function() {
                localStorage.setItem(this.keys.TRANSACTIONS, JSON.stringify(this.transactions));
            },

            // إنشاء ID فريد
            generateId: function() {
                return Date.now() + '-' + Math.random().toString(36).substr(2, 6);
            },

            // إضافة معاملة
            addTransaction: function(type, description, amount) {
                this.transactions.unshift({
                    id: this.generateId(),
                    type: type,
                    description: description,
                    amount: amount,
                    date: new Date().toISOString()
                });
                
                if (this.transactions.length > 50) {
                    this.transactions = this.transactions.slice(0, 50);
                }
                
                this.saveTransactions();
            },

            // تبديل حالة الدفع
            togglePayment: function(memberId) {
                let member = this.members.find(m => m.id == memberId);
                if (member) {
                    member.paid = !member.paid;
                    member.lastPaymentDate = member.paid ? new Date().toISOString() : null;
                    
                    this.addTransaction(
                        'payment',
                        `${member.paid ? 'دفع' : 'إلغاء دفع'} الاشتراك: ${member.name}`,
                        member.paid ? this.MEMBER_FEE : -this.MEMBER_FEE
                    );
                    
                    this.saveMembers();
                    this.renderAll();
                }
            },

            // إضافة عضو
            addMember: function(name) {
                if (!name || !name.trim()) return false;
                
                this.members.push({
                    id: this.generateId(),
                    name: name.trim(),
                    paid: false,
                    lastPaymentDate: null
                });
                
                this.addTransaction('member', `إضافة عضو جديد: ${name.trim()}`, 0);
                this.saveMembers();
                this.renderAll();
                return true;
            },

            // حذف عضو
            deleteMember: function(memberId) {
                let member = this.members.find(m => m.id == memberId);
                if (member && confirm('هل أنت متأكد من حذف هذا العضو؟')) {
                    this.members = this.members.filter(m => m.id != memberId);
                    this.addTransaction('member', `حذف العضو: ${member.name}`, 0);
                    this.saveMembers();
                    this.renderAll();
                }
            },

            // إضافة مصروف
            addExpense: function(name, amount) {
                if (!name || !name.trim() || !amount || amount <= 0) return false;
                
                this.expenses.push({
                    id: this.generateId(),
                    name: name.trim(),
                    amount: Number(amount),
                    date: new Date().toISOString()
                });
                
                this.addTransaction('expense', `مصروف جديد: ${name.trim()}`, Number(amount));
                this.saveExpenses();
                this.renderAll();
                return true;
            },

            // حذف مصروف
            deleteExpense: function(expenseId) {
                let expense = this.expenses.find(e => e.id == expenseId);
                if (expense && confirm('هل أنت متأكد من حذف هذا المصروف؟')) {
                    this.expenses = this.expenses.filter(e => e.id != expenseId);
                    this.addTransaction('expense', `حذف مصروف: ${expense.name}`, -expense.amount);
                    this.saveExpenses();
                    this.renderAll();
                }
            },

            // بدء شهر جديد
            resetMonth: function() {
                if (confirm('هل أنت متأكد من بدء شهر جديد؟ سيتم إعادة تعيين حالة الدفع لجميع الأعضاء.')) {
                    this.members.forEach(m => {
                        m.paid = false;
                        m.lastPaymentDate = null;
                    });
                    
                    this.addTransaction('reset', 'بدء شهر جديد - إعادة تعيين حالات الدفع', 0);
                    this.saveMembers();
                    this.renderAll();
                }
            },

            // مسح سجل المعاملات
            clearTransactions: function() {
                if (confirm('هل أنت متأكد من مسح سجل المعاملات؟')) {
                    this.transactions = [];
                    this.saveTransactions();
                    this.renderTransactions();
                }
            },

            // حساب الإحصائيات
            getStats: function() {
                let totalMembers = this.members.length;
                let paidCount = this.members.filter(m => m.paid).length;
                let collectedAmount = paidCount * this.MEMBER_FEE;
                let totalExpenses = this.expenses.reduce((sum, e) => sum + e.amount, 0);
                
                return {
                    totalMembers: totalMembers,
                    paidCount: paidCount,
                    unpaidCount: totalMembers - paidCount,
                    collectedAmount: collectedAmount,
                    totalExpenses: totalExpenses,
                    balance: collectedAmount - totalExpenses
                };
            },

            // عرض جميع العناصر
            renderAll: function() {
                this.renderStats();
                this.renderMembers();
                this.renderExpenses();
                this.renderTransactions();
                this.checkAlert();
            },

            // عرض الإحصائيات
            renderStats: function() {
                let s = this.getStats();
                let html = `
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">إجمالي الأعضاء</span><div class="stat-icon"><i class="fas fa-users-crown"></i></div></div><div class="stat-value">${s.totalMembers}</div></div>
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">المدفوع</span><div class="stat-icon"><i class="fas fa-check-double"></i></div></div><div class="stat-value">${s.paidCount}</div></div>
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">المتأخر</span><div class="stat-icon"><i class="fas fa-clock"></i></div></div><div class="stat-value">${s.unpaidCount}</div></div>
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">المتحصل</span><div class="stat-icon"><i class="fas fa-sack-dollar"></i></div></div><div class="stat-value">${s.collectedAmount} ₪</div></div>
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">المصاريف</span><div class="stat-icon"><i class="fas fa-file-invoice"></i></div></div><div class="stat-value">${s.totalExpenses} ₪</div></div>
                    <div class="stat-card"><div class="stat-header"><span class="stat-title">الرصيد</span><div class="stat-icon"><i class="fas fa-scale-balanced"></i></div></div><div class="stat-value">${s.balance} ₪</div></div>
                `;
                
                document.getElementById('statsGrid').innerHTML = html;
                document.getElementById('memberStats').innerHTML = `${s.paidCount} مدفوع / ${s.unpaidCount} متأخر`;
                document.getElementById('expenseTotalBadge').innerHTML = `${s.totalExpenses} ₪`;
                
                // تنبيه المصاريف
                document.getElementById('expenseAlert').style.display = s.totalExpenses > s.collectedAmount ? 'block' : 'none';
            },

            // عرض جدول الأعضاء
            renderMembers: function() {
                let tbody = document.getElementById('membersTableBody');
                
                if (this.members.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:40px; color:var(--gray);">لا يوجد أعضاء</td></tr>';
                    return;
                }
                
                let html = '';
                this.members.forEach(m => {
                    let statusClass = m.paid ? 'paid' : '';
                    let statusText = m.paid ? 'مدفوع' : 'غير مدفوع';
                    let statusIcon = m.paid ? 'fa-check-circle' : 'fa-hourglass-half';
                    let paymentDate = m.lastPaymentDate ? moment(m.lastPaymentDate).format('YYYY/MM/DD HH:mm') : '—';
                    
                    html += `<tr>
                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:38px; height:38px; background:rgba(199,162,59,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; color:var(--gold);"><i class="fas fa-user-tie"></i></div><span style="font-weight:600;">${m.name}</span></div></td>
                        <td><span class="status ${statusClass}"><i class="fas ${statusIcon}"></i> ${statusText}</span></td>
                        <td><span style="font-size:12px; color:var(--gray);">${paymentDate}</span></td>
                        <td><div style="display:flex; gap:5px;">
                            <button class="action-btn" onclick="app.togglePayment('${m.id}')"><i class="fas fa-exchange-alt"></i></button>
                            <button class="delete-btn" onclick="app.deleteMember('${m.id}')"><i class="fas fa-trash-alt"></i></button>
                        </div></td>
                    </tr>`;
                });
                
                tbody.innerHTML = html;
            },

            // عرض جدول المصاريف
            renderExpenses: function() {
                let tbody = document.getElementById('expensesTableBody');
                
                if (this.expenses.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:40px; color:var(--gray);">لا توجد مصاريف</td></tr>';
                    return;
                }
                
                let html = '';
                this.expenses.forEach(e => {
                    let date = moment(e.date).format('YYYY/MM/DD HH:mm');
                    
                    html += `<tr>
                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:38px; height:38px; background:rgba(199,162,59,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; color:var(--gold);"><i class="fas fa-file-invoice"></i></div><span>${e.name}</span></div></td>
                        <td><span style="color:var(--gold); font-weight:700;">${e.amount} ₪</span></td>
                        <td><span style="font-size:12px; color:var(--gray);">${date}</span></td>
                        <td><button class="delete-btn" onclick="app.deleteExpense('${e.id}')"><i class="fas fa-trash-alt"></i></button></td>
                    </tr>`;
                });
                
                tbody.innerHTML = html;
            },

            // عرض سجل المعاملات
            renderTransactions: function() {
                let div = document.getElementById('transactionsList');
                
                if (this.transactions.length === 0) {
                    div.innerHTML = '<div style="text-align:center; padding:30px; color:var(--gray);">لا توجد معاملات</div>';
                    return;
                }
                
                let html = '';
                this.transactions.slice(0, 20).forEach(t => {
                    let icon = 'fa-circle';
                    if (t.type === 'payment') icon = 'fa-credit-card';
                    else if (t.type === 'expense') icon = 'fa-file-invoice-dollar';
                    else if (t.type === 'reset') icon = 'fa-calendar';
                    else if (t.type === 'member') icon = 'fa-user-plus';
                    
                    let date = moment(t.date).format('YYYY/MM/DD HH:mm');
                    let amountColor = t.amount > 0 ? '#0b8f6c' : '#b33a4a';
                    let amountSign = t.amount > 0 ? '+' : '';
                    
                    html += `<div class="transaction-item">
                        <div class="tx-icon"><i class="fas ${icon}"></i></div>
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-weight:600; color:white;">${t.description}</span>
                                ${t.amount !== 0 ? `<span style="font-weight:700; color:${amountColor};">${amountSign}${t.amount} ₪</span>` : ''}
                            </div>
                            <div style="margin-top:2px;">
                                <span style="font-size:11px; color:var(--gray);"><i class="fas fa-clock"></i> ${date}</span>
                            </div>
                        </div>
                    </div>`;
                });
                
                div.innerHTML = html;
            },

            // التحقق من تنبيه المصاريف
            checkAlert: function() {
                let s = this.getStats();
                let alertDiv = document.getElementById('expenseAlert');
                alertDiv.style.display = s.totalExpenses > s.collectedAmount ? 'block' : 'none';
            },

            // تحديث التاريخ والوقت
            updateDateTime: function() {
                let now = moment();
                document.getElementById('currentDate').textContent = now.format('dddd، D MMMM YYYY');
                document.getElementById('currentTime').textContent = now.format('HH:mm:ss');
            },

            // ربط الأحداث
            attachEvents: function() {
                // إضافة عضو
                document.getElementById('addMemberBtn').addEventListener('click', () => {
                    let input = document.getElementById('memberNameInput');
                    if (this.addMember(input.value)) {
                        input.value = '';
                        input.focus();
                    }
                });
                
                // إضافة مصروف
                document.getElementById('addExpenseBtn').addEventListener('click', () => {
                    let nameInput = document.getElementById('expenseNameInput');
                    let amountInput = document.getElementById('expenseAmountInput');
                    if (this.addExpense(nameInput.value, amountInput.value)) {
                        nameInput.value = '';
                        amountInput.value = '';
                        nameInput.focus();
                    }
                });
                
                // بدء شهر جديد
                document.getElementById('newMonthBtn').addEventListener('click', () => {
                    this.resetMonth();
                });
                
                // مسح السجل
                document.getElementById('clearLogsBtn').addEventListener('click', () => {
                    this.clearTransactions();
                });
                
                // Enter في الحقول
                document.getElementById('memberNameInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') document.getElementById('addMemberBtn').click();
                });
                
                document.getElementById('expenseNameInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') document.getElementById('addExpenseBtn').click();
                });
                
                document.getElementById('expenseAmountInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') document.getElementById('addExpenseBtn').click();
                });
            }
        };

        // تشغيل التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            DarExecutiveManager.init();
        });
    </script>
</body>
</html>